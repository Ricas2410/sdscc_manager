<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Commission Report - {{ month_name }} {{ year }}</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; font-size: 11pt; padding: 20px; }
        .header { text-align: center; margin-bottom: 30px; border-bottom: 2px solid #000; padding-bottom: 15px; }
        .header h1 { font-size: 20pt; margin-bottom: 5px; }
        .header p { font-size: 10pt; color: #666; }
        .meta { display: flex; justify-content: space-between; margin-bottom: 20px; font-size: 9pt; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { padding: 8px; text-align: left; border: 1px solid #ddd; }
        th { background-color: #f0f0f0; font-weight: bold; }
        .text-right { text-align: right; }
        .text-center { text-align: center; }
        .area-header { background-color: #e8f4f8; font-weight: bold; font-size: 12pt; padding: 10px; margin-top: 20px; }
        .district-header { background-color: #f0f8ff; font-weight: bold; padding: 8px; margin-top: 10px; }
        .total-row { background-color: #fff9e6; font-weight: bold; }
        .grand-total { background-color: #d4edda; font-weight: bold; font-size: 12pt; }
        .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; font-size: 9pt; }
        .signature-section { display: flex; justify-content: space-between; margin-top: 50px; }
        .signature-box { width: 45%; }
        .signature-line { border-top: 1px solid #000; margin-top: 40px; padding-top: 5px; }
        @media print {
            body { padding: 10px; }
            .no-print { display: none; }
            @page { margin: 15mm; }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>SEVENTH DAY SABBATH CHURCH OF CHRIST</h1>
        <p>Pastor Commission Report</p>
        <p style="font-size: 14pt; margin-top: 10px;"><strong>{{ month_name }} {{ year }}</strong></p>
    </div>

    <!-- Meta Information -->
    <div class="meta">
        <div>
            <strong>Report Generated:</strong> {{ generated_at|date:"F d, Y - h:i A" }}<br>
            <strong>Generated By:</strong> {{ generated_by.get_full_name }}
        </div>
        <div style="text-align: right;">
            <strong>Total Branches:</strong> {{ commissions.count }}<br>
            <strong>Total Commission:</strong> GH₵{{ grand_total.total_commission|floatformat:2 }}
        </div>
    </div>

    <!-- Summary Table -->
    <table>
        <thead>
            <tr>
                <th colspan="6" style="background-color: #d4edda; text-align: center; font-size: 12pt;">OVERALL SUMMARY</th>
            </tr>
            <tr>
                <th>Total Target</th>
                <th>Total Collected</th>
                <th>Achievement %</th>
                <th>Total Commission</th>
                <th>Qualified Branches</th>
                <th>Commission Rate</th>
            </tr>
        </thead>
        <tbody>
            <tr class="text-center">
                <td>GH₵{{ grand_total.total_target|floatformat:2 }}</td>
                <td>GH₵{{ grand_total.total_tithe|floatformat:2 }}</td>
                <td>
                    {% widthratio grand_total.total_tithe grand_total.total_target 100 %}%
                </td>
                <td><strong>GH₵{{ grand_total.total_commission|floatformat:2 }}</strong></td>
                <td>{{ commissions|length }}</td>
                <td>10%</td>
            </tr>
        </tbody>
    </table>

    <!-- Detailed Breakdown by Area -->
    {% for area_name, area_data in areas_data.items %}
    <div class="area-header">
        {{ area_name|upper }} AREA - Total Commission: GH₵{{ area_data.total_commission|floatformat:2 }}
    </div>

    {% for district_name, district_data in area_data.districts.items %}
    <div class="district-header">
        {{ district_name }} District
    </div>

    <table>
        <thead>
            <tr>
                <th style="width: 25%;">Branch</th>
                <th style="width: 25%;">Pastor</th>
                <th class="text-right">Target</th>
                <th class="text-right">Collected</th>
                <th class="text-center">Achievement</th>
                <th class="text-right">Commission (10%)</th>
            </tr>
        </thead>
        <tbody>
            {% for commission in district_data.branches %}
            <tr>
                <td>{{ commission.branch.name }}</td>
                <td>{{ commission.recipient.get_full_name }}</td>
                <td class="text-right">GH₵{{ commission.target_amount|floatformat:2 }}</td>
                <td class="text-right">GH₵{{ commission.tithe_collected|floatformat:2 }}</td>
                <td class="text-center">{{ commission.percentage_achieved|floatformat:1 }}%</td>
                <td class="text-right"><strong>GH₵{{ commission.commission_amount|floatformat:2 }}</strong></td>
            </tr>
            {% endfor %}
            <tr class="total-row">
                <td colspan="3">District Total</td>
                <td class="text-right">GH₵{{ district_data.total_tithe|floatformat:2 }}</td>
                <td class="text-center">-</td>
                <td class="text-right"><strong>GH₵{{ district_data.total_commission|floatformat:2 }}</strong></td>
            </tr>
        </tbody>
    </table>
    {% endfor %}
    {% endfor %}

    <!-- Grand Total -->
    <table>
        <tr class="grand-total">
            <td style="width: 50%;">GRAND TOTAL - ALL AREAS</td>
            <td class="text-right">Total Tithe: GH₵{{ grand_total.total_tithe|floatformat:2 }}</td>
            <td class="text-right">Total Commission: GH₵{{ grand_total.total_commission|floatformat:2 }}</td>
        </tr>
    </table>

    <!-- Signature Section -->
    <div class="signature-section">
        <div class="signature-box">
            <div class="signature-line">
                <strong>Prepared By:</strong><br>
                {{ generated_by.get_full_name }}<br>
                {{ generated_by.get_role_display }}
            </div>
        </div>
        <div class="signature-box">
            <div class="signature-line">
                <strong>Approved By:</strong><br>
                Mission Administrator<br>
                Date: _________________
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p style="text-align: center; color: #666;">
            This is a computer-generated report. All commission payments are subject to approval and verification.<br>
            For inquiries, contact the Mission Finance Office.
        </p>
    </div>

    <!-- Print Button (hidden when printing) -->
    <div class="no-print" style="text-align: center; margin-top: 20px;">
        <button onclick="window.print()" style="padding: 10px 30px; font-size: 14pt; cursor: pointer; background-color: #007bff; color: white; border: none; border-radius: 5px;">
            Print Report
        </button>
        <button onclick="window.close()" style="padding: 10px 30px; font-size: 14pt; cursor: pointer; background-color: #6c757d; color: white; border: none; border-radius: 5px; margin-left: 10px;">
            Close
        </button>
    </div>
</body>
</html>
